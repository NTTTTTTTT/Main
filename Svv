local PlaceID = game.PlaceId
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local AllIDs = {} -- Danh sách các server đã tham gia

local function getServers()
    local servers = {}
    local cursor = ""

    repeat
        local url = "https://games.roblox.com/v1/games/" .. PlaceID .. "/servers/Public?sortOrder=Asc&limit=100"
        if cursor ~= "" then
            url = url .. "&cursor=" .. cursor
        end
        
        local success, response = pcall(function()
            return HttpService:JSONDecode(game:HttpGet(url))
        end)

        if success and response and response.data then
            for _, server in ipairs(response.data) do
                if server.playing < server.maxPlayers and not table.find(AllIDs, server.id) then
                    table.insert(servers, server.id) -- Chỉ thêm server chưa tham gia
                end
            end
            cursor = response.nextPageCursor or ""
        else
            print("Không thể lấy danh sách server.")
            return nil
        end
    until not cursor or cursor == ""
    
    return servers
end

local function teleportToRandomServer()
    local servers = getServers()
    if servers and #servers > 0 then
        local randomIndex = math.random(1, #servers)
        local selectedServer = servers[randomIndex]
        table.insert(AllIDs, selectedServer) -- Lưu server đã vào
        print("Đang chuyển đến server ID:", selectedServer)
        TeleportService:TeleportToPlaceInstance(PlaceID, selectedServer)
    else
        print("Không tìm thấy server khả dụng.")
    end
end

-- Gọi hàm để đổi server
teleportToRandomServer()
